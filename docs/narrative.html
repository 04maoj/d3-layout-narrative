<!DOCTYPE html>

<html>
<head>
  <title>narrative.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>narrative.js</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>d3.layout.narrative=<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>{<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">a</span><span class="hljs-params">()</span></span>{<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">a</span><span class="hljs-params">(a)</span></span>{<span class="hljs-keyword">var</span> d,e;<span class="hljs-keyword">return</span> d=b.reduce(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(b,c)</span></span>{<span class="hljs-keyword">return</span> a.character===c.character&amp;&amp;b[<span class="hljs-number">0</span>]++,a.scene===c.scene&amp;&amp;b[<span class="hljs-number">1</span>]++,b},[<span class="hljs-number">0</span>,<span class="hljs-number">0</span>]),e=d[<span class="hljs-number">0</span>]&gt;<span class="hljs-number">1</span>&amp;&amp;d[<span class="hljs-number">1</span>]&gt;<span class="hljs-number">1</span>,c=c&amp;&amp;e,e}<span class="hljs-keyword">var</span> b,c;<span class="hljs-keyword">for</span>(b=[],u.forEach(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(a)</span></span>{a.characters.forEach(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(c)</span></span>{c=<span class="hljs-string">"object"</span>==<span class="hljs-keyword">typeof</span> c?c:v[c],c._x=c.x||!<span class="hljs-number">1</span>,c._y=c.y||!<span class="hljs-number">1</span>,c._width=c.width||!<span class="hljs-number">1</span>,b.push({character:c,scene:a}),a.appearances=[],a.bounds=q,c.appearances=[]}),a._x=a.x||!<span class="hljs-number">1</span>,a._y=a.y||!<span class="hljs-number">1</span>});!c;)c=!<span class="hljs-number">0</span>,b=b.filter(a);v=[],u=[],b.forEach(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(a)</span></span>{a.scene.appearances.push(a),a.character.appearances.push(a),-<span class="hljs-number">1</span>===v.indexOf(a.character)&amp;&amp;v.push(a.character),-<span class="hljs-number">1</span>===u.indexOf(a.scene)&amp;&amp;u.push(a.scene)})}<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">b</span><span class="hljs-params">()</span></span>{<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">a</span><span class="hljs-params">(a)</span></span>{<span class="hljs-keyword">var</span> b,c,d;<span class="hljs-keyword">for</span>(d=[],b=a.length;b--;)<span class="hljs-keyword">for</span>(c=b;c--;)d.push([v.indexOf(a[b].character),v.indexOf(a[c].character)]);<span class="hljs-keyword">return</span> d}<span class="hljs-keyword">var</span> b,c,d,e;b=v.map(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(a,b)</span></span>{<span class="hljs-keyword">return</span> b}),c=[],u.forEach(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(b)</span></span>{c=c.concat(a(b.appearances))}),c=c.reduce(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(a,b)</span></span>{<span class="hljs-keyword">var</span> c;<span class="hljs-keyword">return</span> c=a.filter(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(a)</span></span>{<span class="hljs-keyword">return</span>!(a.target!==b[<span class="hljs-number">0</span>]&amp;&amp;a.target!==b[<span class="hljs-number">1</span>]||a.source!==b[<span class="hljs-number">0</span>]&amp;&amp;a.source!==b[<span class="hljs-number">1</span>])})[<span class="hljs-number">0</span>]||{source:b[<span class="hljs-number">0</span>],target:b[<span class="hljs-number">1</span>],weight:<span class="hljs-number">0</span>},c.weight++,<span class="hljs-number">1</span>===c.weight&amp;&amp;a.push(c),a},[]),d=s().nodes(b).edges(c)(),D=[],e={},v.forEach(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(a,b)</span></span>{<span class="hljs-keyword">var</span> c,f;c=d[b],f=e[c],f||(f={id:c,characters:[]},D.push(f),e[c]=f),f.characters.push(a),a.group=f})}<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">c</span><span class="hljs-params">()</span></span>{u.forEach(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(a)</span></span>{<span class="hljs-keyword">var</span> b,c,d;b=[],c={},a.appearances.forEach(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(a)</span></span>{<span class="hljs-keyword">var</span> d,e;e=D.indexOf(a.character.group),d=c[e],d||(d={groupIndex:e,count:<span class="hljs-number">0</span>},c[e]=d,b.push(d)),d.count++}),b.sort(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(a,b)</span></span>{<span class="hljs-keyword">return</span> a.count-b.count}),d=D[b.pop().groupIndex],d.medianCount=d.medianCount||<span class="hljs-number">0</span>,d.medianCount++,a.group=d})}<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">d</span><span class="hljs-params">()</span></span>{u.forEach(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(a)</span></span>{<span class="hljs-keyword">var</span> b;b=a.appearances.map(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(a)</span></span>{<span class="hljs-keyword">return</span> a.character}),a.group.appearances=a.group.appearances||[],a.group.appearances=a.group.appearances.concat(b.filter(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(b)</span></span>{<span class="hljs-keyword">return</span>-<span class="hljs-number">1</span>===a.group.appearances.indexOf(b)}))})}<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">e</span><span class="hljs-params">()</span></span>{<span class="hljs-keyword">var</span> a,b,c,d;<span class="hljs-keyword">for</span>(D.sort(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(a,b)</span></span>{<span class="hljs-keyword">return</span> b.medianCount-a.medianCount}),b=[],d=<span class="hljs-number">0</span>;D.length;)c=a?D.pop():D.shift(),c.order=d,d++,b.push(c),a=!a;D=b}<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">f</span><span class="hljs-params">()</span></span>{<span class="hljs-keyword">var</span> a;a=<span class="hljs-number">0</span>,D.forEach(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(b)</span></span>{b.min=a,b.max=a=p(b.appearances.length)+b.min,a+=groupMargin})}<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">g</span><span class="hljs-params">()</span></span>{v.forEach(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(a)</span></span>{<span class="hljs-keyword">var</span> b,c;b=c=<span class="hljs-number">0</span>,a.appearances.forEach(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(a)</span></span>{c++,b+=D.indexOf(a.scene.group)}),a.averageScenePosition=b/c}),D.forEach(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(a)</span></span>{a.characters.sort(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(a,b)</span></span>{<span class="hljs-keyword">var</span> c;<span class="hljs-keyword">return</span> c=a.averageScenePosition-b.averageScenePosition,<span class="hljs-number">0</span>!==c?c:v.indexOf(a)-v.indexOf(b)})})}<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">h</span><span class="hljs-params">()</span></span>{D.forEach(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(a)</span></span>{a.appearances.sort(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(a,b)</span></span>{<span class="hljs-keyword">var</span> c;<span class="hljs-keyword">return</span> c=a.group.order-b.group.order,<span class="hljs-number">0</span>!==c?c:(c=a.averageScenePosition-b.averageScenePosition,<span class="hljs-number">0</span>!==c?c:v.indexOf(a)-v.indexOf(b))})})}<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">i</span><span class="hljs-params">()</span></span>{<span class="hljs-keyword">var</span> a=<span class="hljs-number">1</span>;u.forEach(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(b)</span></span>{b.start=b.start||a,b.duration=b.duration||<span class="hljs-number">1</span>,a+=b.duration}),B=(y[<span class="hljs-number">0</span>]-C[<span class="hljs-number">0</span>])/a}<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">j</span><span class="hljs-params">()</span></span>{u.forEach(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(a)</span></span>{a.appearances.sort(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(a,b)</span></span>{<span class="hljs-keyword">var</span> c;<span class="hljs-keyword">return</span> c=a.character.group.order-b.character.group.order,<span class="hljs-number">0</span>!==c?c:(c=a.character.averageScenePosition-b.character.averageScenePosition,<span class="hljs-number">0</span>!==c?c:v.indexOf(a.character)-v.indexOf(b.character))}),a.appearances.forEach(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(a,b)</span></span>{a.y=o(b),a.x=<span class="hljs-number">0</span>})})}<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">k</span><span class="hljs-params">()</span></span>{u.forEach(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(a)</span></span>{<span class="hljs-keyword">var</span> b,c,d;a.height=p(a.appearances.length),a.width=<span class="hljs-number">0</span>,d=a.appearances.filter(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(b)</span></span>{<span class="hljs-keyword">return</span> b.character.group!==a.group}),d.length||(d=a.appearances),b=d.reduce(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(b,c)</span></span>{<span class="hljs-keyword">return</span> b+=o(a.group.appearances.indexOf(c.character))+a.group.min},<span class="hljs-number">0</span>),c=b/d.length,a.y=a._y||c-a.height/<span class="hljs-number">2</span>,a.x=a._x||B*a.start+C[<span class="hljs-number">0</span>]})}<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">l</span><span class="hljs-params">()</span></span>{<span class="hljs-keyword">var</span> a;a=v.map(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(a)</span></span>{<span class="hljs-keyword">return</span> a.appearances[<span class="hljs-number">0</span>]}),w=[],a.forEach(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(a)</span></span>{<span class="hljs-keyword">var</span> b,c,d;c=a.scene.x-<span class="hljs-number">.5</span>*B,d=a.y+a.scene.y,c-C[<span class="hljs-number">0</span>]&lt;C[<span class="hljs-number">0</span>]&amp;&amp;(c=C[<span class="hljs-number">0</span>]),b={character:a.character,x:a.character._x||c,y:a.character._y||d,width:a.character._width||C[<span class="hljs-number">0</span>],height:a.character._height||C[<span class="hljs-number">1</span>],bounds:r},a.character.introduction=b,w.push(b)})}<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">m</span><span class="hljs-params">()</span></span>{<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">a</span><span class="hljs-params">(a)</span></span>{<span class="hljs-keyword">var</span> b,c,d,e;<span class="hljs-keyword">return</span> b=d3.min(a,<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(a)</span></span>{<span class="hljs-keyword">return</span> a.bounds()[<span class="hljs-number">0</span>][<span class="hljs-number">0</span>]}),c=d3.max(a,<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(a)</span></span>{<span class="hljs-keyword">return</span> a.bounds()[<span class="hljs-number">1</span>][<span class="hljs-number">0</span>]}),d=d3.min(a,<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(a)</span></span>{<span class="hljs-keyword">return</span> a.bounds()[<span class="hljs-number">0</span>][<span class="hljs-number">1</span>]}),e=d3.max(a,<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(a)</span></span>{<span class="hljs-keyword">return</span> a.bounds()[<span class="hljs-number">1</span>][<span class="hljs-number">1</span>]}),[[b,d],[c,e]]}<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">b</span><span class="hljs-params">(a)</span></span>{<span class="hljs-keyword">var</span> b,d;<span class="hljs-keyword">for</span>(collisions=[],b=<span class="hljs-number">0</span>,d=e.length;d&gt;b;b++)a!==e[b]&amp;&amp;c(a.bounds(),e[b].bounds())&amp;&amp;collisions.push(e[b]);<span class="hljs-keyword">return</span> collisions.length?collisions:!<span class="hljs-number">1</span>}<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">c</span><span class="hljs-params">(a,b)</span></span>{<span class="hljs-keyword">return</span>!(a[<span class="hljs-number">1</span>][<span class="hljs-number">0</span>]&lt;=b[<span class="hljs-number">0</span>][<span class="hljs-number">0</span>]||b[<span class="hljs-number">1</span>][<span class="hljs-number">0</span>]&lt;=a[<span class="hljs-number">0</span>][<span class="hljs-number">0</span>]||a[<span class="hljs-number">1</span>][<span class="hljs-number">1</span>]&lt;=b[<span class="hljs-number">0</span>][<span class="hljs-number">1</span>]||b[<span class="hljs-number">1</span>][<span class="hljs-number">1</span>]&lt;=a[<span class="hljs-number">0</span>][<span class="hljs-number">1</span>])}<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">d</span><span class="hljs-params">(a,b)</span></span>{<span class="hljs-keyword">return</span> a.y-b.y}<span class="hljs-keyword">var</span> e,f;e=w.concat(u),f=w.slice(),f.sort(d),f.forEach(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(c)</span></span>{<span class="hljs-keyword">var</span> d,e,f,g,h,i,j;<span class="hljs-keyword">for</span>(i=b(c),i&amp;&amp;(j=i.filter(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(a)</span></span>{<span class="hljs-keyword">return</span> a.character}),j.forEach(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(a)</span></span>{a.y+=c.bounds()[<span class="hljs-number">1</span>][<span class="hljs-number">1</span>]-a.bounds()[<span class="hljs-number">0</span>][<span class="hljs-number">1</span>]}),i=i.filter(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(a)</span></span>{<span class="hljs-keyword">return</span>!a.character})),e=a(i),f=c.bounds(),h=c.y,d=[e[<span class="hljs-number">1</span>][<span class="hljs-number">1</span>]-f[<span class="hljs-number">0</span>][<span class="hljs-number">1</span>],e[<span class="hljs-number">0</span>][<span class="hljs-number">1</span>]-f[<span class="hljs-number">1</span>][<span class="hljs-number">1</span>]],d.sort(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(a,b)</span></span>{<span class="hljs-keyword">return</span> <span class="hljs-built_in">Math</span>.abs(a)-<span class="hljs-built_in">Math</span>.abs(b)});(g=d.shift())&amp;&amp;(c.y+=g,i=b(c));){<span class="hljs-keyword">if</span>(g&gt;<span class="hljs-number">0</span>&amp;&amp;i.every(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(a)</span></span>{<span class="hljs-keyword">return</span> a.character})){i.forEach(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(a)</span></span>{a.y+=c.bounds()[<span class="hljs-number">1</span>][<span class="hljs-number">1</span>]-a.bounds()[<span class="hljs-number">0</span>][<span class="hljs-number">1</span>]});<span class="hljs-keyword">break</span>}c.y=h}})}<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">n</span><span class="hljs-params">()</span></span>{x=[],v.forEach(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(a)</span></span>{<span class="hljs-keyword">var</span> b;<span class="hljs-keyword">for</span>(x.push({character:a,source:a.introduction,target:a.appearances[<span class="hljs-number">0</span>]}),b=<span class="hljs-number">1</span>;b&lt;a.appearances.length;b++)x.push({character:a,source:a.appearances[b-<span class="hljs-number">1</span>],target:a.appearances[b]})})}<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">o</span><span class="hljs-params">(a)</span></span>{<span class="hljs-keyword">return</span>(a+<span class="hljs-number">1</span>)*(z+A)-z/<span class="hljs-number">2</span>}<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">p</span><span class="hljs-params">(a)</span></span>{<span class="hljs-keyword">return</span> o(a-<span class="hljs-number">1</span>)+z/<span class="hljs-number">2</span>+A}<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">q</span><span class="hljs-params">()</span></span>{<span class="hljs-keyword">return</span>[[<span class="hljs-keyword">this</span>.x,<span class="hljs-keyword">this</span>.y],[<span class="hljs-keyword">this</span>.x+<span class="hljs-keyword">this</span>.width,<span class="hljs-keyword">this</span>.y+<span class="hljs-keyword">this</span>.height]]}<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">r</span><span class="hljs-params">()</span></span>{<span class="hljs-keyword">return</span>[[<span class="hljs-keyword">this</span>.x-<span class="hljs-keyword">this</span>.width,<span class="hljs-keyword">this</span>.y-<span class="hljs-keyword">this</span>.height/<span class="hljs-number">2</span>],[<span class="hljs-keyword">this</span>.x,<span class="hljs-keyword">this</span>.y+<span class="hljs-keyword">this</span>.height/<span class="hljs-number">2</span>]]}<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">s</span><span class="hljs-params">()</span></span>{<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">a</span><span class="hljs-params">(a)</span></span>{<span class="hljs-keyword">var</span> b={};<span class="hljs-keyword">return</span> a.forEach(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(a)</span></span>{b[a]=!<span class="hljs-number">0</span>}),<span class="hljs-built_in">Object</span>.keys(b)}<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">b</span><span class="hljs-params">(a)</span></span>{<span class="hljs-keyword">var</span> b=[];<span class="hljs-keyword">for</span>(<span class="hljs-keyword">var</span> c <span class="hljs-keyword">in</span> a)a.hasOwnProperty(c)&amp;&amp;b.push(a[c]);<span class="hljs-keyword">return</span> b}<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">c</span><span class="hljs-params">(a,b)</span></span>{<span class="hljs-keyword">var</span> c=a._assoc_mat[b]?<span class="hljs-built_in">Object</span>.keys(a._assoc_mat[b]):[],d=<span class="hljs-number">0</span>;<span class="hljs-keyword">return</span> c.forEach(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(c)</span></span>{<span class="hljs-keyword">var</span> e=a._assoc_mat[b][c]||<span class="hljs-number">1</span>;b==c&amp;&amp;(e*=<span class="hljs-number">2</span>),d+=e}),d}<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">d</span><span class="hljs-params">(a,b)</span></span>{<span class="hljs-keyword">if</span>(<span class="hljs-string">"undefined"</span>==<span class="hljs-keyword">typeof</span> a._assoc_mat[b])<span class="hljs-keyword">return</span>[];<span class="hljs-keyword">var</span> c=<span class="hljs-built_in">Object</span>.keys(a._assoc_mat[b]);<span class="hljs-keyword">return</span> c}<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">e</span><span class="hljs-params">(a,b,c)</span></span>{<span class="hljs-keyword">return</span> a._assoc_mat[b]?a._assoc_mat[b][c]:<span class="hljs-keyword">void</span> <span class="hljs-number">0</span>}<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">f</span><span class="hljs-params">(a)</span></span>{<span class="hljs-keyword">var</span> b=<span class="hljs-number">0</span>;<span class="hljs-keyword">return</span> a.edges.forEach(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(a)</span></span>{b+=a.weight}),b}<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">g</span><span class="hljs-params">(a,b)</span></span>{i(a,b);<span class="hljs-keyword">var</span> c=a.edges.map(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(a)</span></span>{<span class="hljs-keyword">return</span> a.source+<span class="hljs-string">"_"</span>+a.target}).indexOf(b.source+<span class="hljs-string">"_"</span>+b.target);-<span class="hljs-number">1</span>!=c?a.edges[c].weight=b.weight:a.edges.push(b)}<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">h</span><span class="hljs-params">(a)</span></span>{<span class="hljs-keyword">var</span> b={};<span class="hljs-keyword">return</span> a.forEach(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(a)</span></span>{b[a.source]=b[a.source]||{},b[a.source][a.target]=a.weight,b[a.target]=b[a.target]||{},b[a.target][a.source]=a.weight}),b}<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">i</span><span class="hljs-params">(a,b)</span></span>{a._assoc_mat[b.source]=a._assoc_mat[b.source]||{},a._assoc_mat[b.source][b.target]=b.weight,a._assoc_mat[b.target]=a._assoc_mat[b.target]||{},a._assoc_mat[b.target][b.source]=b.weight}<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">j</span><span class="hljs-params">(a)</span></span>{<span class="hljs-keyword">if</span>(<span class="hljs-literal">null</span>==a||<span class="hljs-string">"object"</span>!=<span class="hljs-keyword">typeof</span> a)<span class="hljs-keyword">return</span> a;<span class="hljs-keyword">var</span> b=a.constructor();<span class="hljs-keyword">for</span>(<span class="hljs-keyword">var</span> c <span class="hljs-keyword">in</span> a)b[c]=j(a[c]);<span class="hljs-keyword">return</span> b}<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">k</span><span class="hljs-params">(a,b,g)</span></span>{b.nodes_to_com={},b.total_weight=<span class="hljs-number">0</span>,b.internals={},b.degrees={},b.gdegrees={},b.loops={},b.total_weight=f(a),a.nodes.forEach(<span class="hljs-string">"undefined"</span>==<span class="hljs-keyword">typeof</span> g?<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(d,f)</span></span>{b.nodes_to_com[d]=f;<span class="hljs-keyword">var</span> g=c(a,d);<span class="hljs-keyword">if</span>(<span class="hljs-number">0</span>&gt;g)<span class="hljs-keyword">throw</span><span class="hljs-string">"Bad graph type, use positive weights!"</span>;b.degrees[f]=g,b.gdegrees[d]=g,b.loops[d]=e(a,d,d)||<span class="hljs-number">0</span>,b.internals[f]=b.loops[d]}:<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(e)</span></span>{<span class="hljs-keyword">var</span> f=g[e];b.nodes_to_com[e]=f;<span class="hljs-keyword">var</span> h=c(a,e);b.degrees[f]=(b.degrees[f]||<span class="hljs-number">0</span>)+h,b.gdegrees[e]=h;<span class="hljs-keyword">var</span> i=<span class="hljs-number">0</span>,j=d(a,e);j.forEach(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(b)</span></span>{<span class="hljs-keyword">var</span> c=a._assoc_mat[e][b];<span class="hljs-keyword">if</span>(<span class="hljs-number">0</span>&gt;=c)<span class="hljs-keyword">throw</span><span class="hljs-string">"Bad graph type, use positive weights"</span>;g[b]==f&amp;&amp;(i+=b==e?c:c/<span class="hljs-number">2</span>)}),b.internals[f]=(b.internals[f]||<span class="hljs-number">0</span>)+i})}<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">l</span><span class="hljs-params">(c)</span></span>{<span class="hljs-keyword">var</span> d=c.total_weight,e=<span class="hljs-number">0</span>,f=a(b(c.nodes_to_com));<span class="hljs-keyword">return</span> f.forEach(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(a)</span></span>{<span class="hljs-keyword">var</span> b=c.internals[a]||<span class="hljs-number">0</span>,f=c.degrees[a]||<span class="hljs-number">0</span>;d&gt;<span class="hljs-number">0</span>&amp;&amp;(e=e+b/d-<span class="hljs-built_in">Math</span>.pow(f/(<span class="hljs-number">2</span>*d),<span class="hljs-number">2</span>))}),e}<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">m</span><span class="hljs-params">(a,b,c)</span></span>{<span class="hljs-keyword">var</span> e={},f=d(b,a);<span class="hljs-keyword">return</span> f.forEach(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(d)</span></span>{<span class="hljs-keyword">if</span>(d!=a){<span class="hljs-keyword">var</span> f=b._assoc_mat[a][d]||<span class="hljs-number">1</span>,g=c.nodes_to_com[d];e[g]=(e[g]||<span class="hljs-number">0</span>)+f}}),e}<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">n</span><span class="hljs-params">(a,b,c,d)</span></span>{d.nodes_to_com[a]=+b,d.degrees[b]=(d.degrees[b]||<span class="hljs-number">0</span>)+(d.gdegrees[a]||<span class="hljs-number">0</span>),d.internals[b]=(d.internals[b]||<span class="hljs-number">0</span>)+c+(d.loops[a]||<span class="hljs-number">0</span>)}<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">o</span><span class="hljs-params">(a,b,c,d)</span></span>{d.degrees[b]=(d.degrees[b]||<span class="hljs-number">0</span>)-(d.gdegrees[a]||<span class="hljs-number">0</span>),d.internals[b]=(d.internals[b]||<span class="hljs-number">0</span>)-c-(d.loops[a]||<span class="hljs-number">0</span>),d.nodes_to_com[a]=-<span class="hljs-number">1</span>}<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">p</span><span class="hljs-params">(a)</span></span>{<span class="hljs-keyword">var</span> b=<span class="hljs-number">0</span>,c=j(a),d={},e=<span class="hljs-built_in">Object</span>.keys(a);<span class="hljs-keyword">return</span> e.forEach(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(e)</span></span>{<span class="hljs-keyword">var</span> f=a[e],g=<span class="hljs-string">"undefined"</span>==<span class="hljs-keyword">typeof</span> d[f]?-<span class="hljs-number">1</span>:d[f];-<span class="hljs-number">1</span>==g&amp;&amp;(d[f]=b,g=b,b+=<span class="hljs-number">1</span>),c[e]=g}),c}<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">q</span><span class="hljs-params">(a,b)</span></span>{<span class="hljs-keyword">for</span>(<span class="hljs-keyword">var</span> c=!<span class="hljs-number">0</span>,d=<span class="hljs-number">0</span>,e=l(b),f=e;c&amp;&amp;d!=x&amp;&amp;(e=f,c=!<span class="hljs-number">1</span>,d+=<span class="hljs-number">1</span>,a.nodes.forEach(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(d)</span></span>{<span class="hljs-keyword">var</span> e=b.nodes_to_com[d],f=(b.gdegrees[d]||<span class="hljs-number">0</span>)/(<span class="hljs-number">2</span>*b.total_weight),g=m(d,a,b);o(d,e,g[e]||<span class="hljs-number">0</span>,b);<span class="hljs-keyword">var</span> h=e,i=<span class="hljs-number">0</span>,j=<span class="hljs-built_in">Object</span>.keys(g);j.forEach(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(a)</span></span>{<span class="hljs-keyword">var</span> c=g[a]-(b.degrees[a]||<span class="hljs-number">0</span>)*f;c&gt;i&amp;&amp;(i=c,h=a)}),n(d,h,g[h]||<span class="hljs-number">0</span>,b),h!=e&amp;&amp;(c=!<span class="hljs-number">0</span>)}),f=l(b),!(y&gt;f-e)););}<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">r</span><span class="hljs-params">(c,d)</span></span>{<span class="hljs-keyword">var</span> f,h,i={nodes:[],edges:[],_assoc_mat:{}},j=b(c);<span class="hljs-keyword">return</span> i.nodes=i.nodes.concat(a(j)),d.edges.forEach(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(a)</span></span>{h=a.weight||<span class="hljs-number">1</span>;<span class="hljs-keyword">var</span> b=c[a.source],d=c[a.target];f=e(i,b,d)||<span class="hljs-number">0</span>;<span class="hljs-keyword">var</span> j=f+h;g(i,{source:b,target:d,weight:j})}),i}<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">s</span><span class="hljs-params">(a,b)</span></span>{<span class="hljs-keyword">for</span>(<span class="hljs-keyword">var</span> c=j(a[<span class="hljs-number">0</span>]),d=<span class="hljs-number">1</span>;b+<span class="hljs-number">1</span>&gt;d;d++)<span class="hljs-built_in">Object</span>.keys(c).forEach(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(b)</span></span>{<span class="hljs-keyword">var</span> e=b,f=c[b];c[e]=a[d][f]});<span class="hljs-keyword">return</span> c}<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">t</span><span class="hljs-params">(a,b)</span></span>{<span class="hljs-keyword">if</span>(<span class="hljs-number">0</span>==a.edges.length){<span class="hljs-keyword">var</span> c={};<span class="hljs-keyword">return</span> a.nodes.forEach(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(a)</span></span>{c[a]=a}),c}<span class="hljs-keyword">var</span> d={};k(z,d,b);<span class="hljs-keyword">var</span> e=l(d),f=[];q(z,d);<span class="hljs-keyword">var</span> g=l(d),h=p(d.nodes_to_com);f.push(h),e=g;<span class="hljs-keyword">var</span> i=r(h,z);<span class="hljs-keyword">for</span>(k(i,d);q(i,d),g=l(d),!(y&gt;g-e);)h=p(d.nodes_to_com),f.push(h),e=g,i=r(h,i),k(i,d);<span class="hljs-keyword">return</span> f}<span class="hljs-keyword">var</span> u,v,w,x=-<span class="hljs-number">1</span>,y=<span class="hljs-number">1e-7</span>,z={},A=<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>{<span class="hljs-keyword">var</span> a=t(z,w);<span class="hljs-keyword">return</span> s(a,a.length-<span class="hljs-number">1</span>)};<span class="hljs-keyword">return</span> A.nodes=<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(a)</span></span>{<span class="hljs-keyword">return</span> <span class="hljs-built_in">arguments</span>.length&gt;<span class="hljs-number">0</span>&amp;&amp;(u=a),A},A.edges=<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(a)</span></span>{<span class="hljs-keyword">if</span>(<span class="hljs-string">"undefined"</span>==<span class="hljs-keyword">typeof</span> u)<span class="hljs-keyword">throw</span><span class="hljs-string">"Please provide the graph nodes first!"</span>;<span class="hljs-keyword">if</span>(<span class="hljs-built_in">arguments</span>.length&gt;<span class="hljs-number">0</span>){v=a;<span class="hljs-keyword">var</span> b=h(a);z={nodes:u,edges:v,_assoc_mat:b}}<span class="hljs-keyword">return</span> A},A.partition_init=<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(a)</span></span>{<span class="hljs-keyword">return</span> <span class="hljs-built_in">arguments</span>.length&gt;<span class="hljs-number">0</span>&amp;&amp;(w=a),A},A}<span class="hljs-keyword">var</span> t,u,v,w,x,y,z,A,B,C,D;<span class="hljs-keyword">return</span> y=[<span class="hljs-number">1</span>,<span class="hljs-number">1</span>],B=<span class="hljs-number">1</span>,z=<span class="hljs-number">10</span>,A=<span class="hljs-number">5</span>,C=[<span class="hljs-number">100</span>,<span class="hljs-number">15</span>],groupMargin=<span class="hljs-number">0</span>,t={},t.scenes=<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(a)</span></span>{<span class="hljs-keyword">return</span> <span class="hljs-built_in">arguments</span>.length?(u=a,t):u},t.characters=<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(a)</span></span>{<span class="hljs-keyword">return</span> <span class="hljs-built_in">arguments</span>.length?(v=a,t):v},t.size=<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(a)</span></span>{<span class="hljs-keyword">return</span> <span class="hljs-built_in">arguments</span>.length?(y=a,t):y},t.characterHeight=<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(a)</span></span>{<span class="hljs-keyword">return</span> <span class="hljs-built_in">arguments</span>.length?(z=a,t):z},t.characterMargin=<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(a)</span></span>{<span class="hljs-keyword">return</span> <span class="hljs-built_in">arguments</span>.length?(A=a,t):A},t.groupMargin=<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(a)</span></span>{<span class="hljs-keyword">return</span> <span class="hljs-built_in">arguments</span>.length?(groupMargin=a,t):groupMargin},t.labelSize=<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(a)</span></span>{<span class="hljs-keyword">return</span> <span class="hljs-built_in">arguments</span>.length?(C=a,t):C},t.link=<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>{<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">a</span><span class="hljs-params">(a)</span></span>{<span class="hljs-keyword">var</span> c,d,e,f,g,h,i;<span class="hljs-keyword">return</span> c=a.source.scene?a.source.scene.x+a.source.x:a.source.x,h=a.source.scene?a.source.scene.y+a.source.y:a.source.y,d=a.target.scene?a.target.scene.x+a.target.x:a.target.x,i=a.target.scene?a.target.scene.y+a.target.y:a.target.y,e=d3.interpolateNumber(c,d),f=e(b),g=e(<span class="hljs-number">1</span>-b),<span class="hljs-string">"M"</span>+c+<span class="hljs-string">","</span>+h+<span class="hljs-string">"C"</span>+f+<span class="hljs-string">","</span>+h+<span class="hljs-string">" "</span>+g+<span class="hljs-string">","</span>+i+<span class="hljs-string">" "</span>+d+<span class="hljs-string">","</span>+i}<span class="hljs-keyword">var</span> b=<span class="hljs-number">.5</span>;<span class="hljs-keyword">return</span> a.curvature=<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(c)</span></span>{<span class="hljs-keyword">return</span> <span class="hljs-built_in">arguments</span>.length?(b=+c,a):b},a},t.links=<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>{<span class="hljs-keyword">return</span> x},t.groups=<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>{<span class="hljs-keyword">return</span> D},t.introductions=<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>{<span class="hljs-keyword">return</span> w},t.layout=<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>{<span class="hljs-keyword">return</span> a(),b(),c(),d(),e(),f(),g(),h(),i(),j(),k(),l(),m(),n(),<span class="hljs-built_in">console</span>.log(v.length,u.length,D),t},t.relayout=<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>{<span class="hljs-keyword">return</span> n(),t},t};</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
